MethaneSignalProcessor (MSP)
====================

MethaneSignalProcessor (MSP) is an open-source tool for processing high-frequency CHâ‚„ (methane) concentration time-series acquired with floating chambers.
The routine separates diffusive and ebullitive emission components, applies advanced signal correction, and exports numerical summaries together with graphical outputs.

ğŸ“¦ Project Overview
-------------------
MSP is designed to support automated, standardized, and reproducible analysis of aquatic methane signals, particularly those obtained with low-cost sensors under field conditions.

Main capabilities:
- Automated data cleaning and preprocessing
- Advanced digital filtering
- Adaptive peak detection for ebullition events
- Dual-branch correction with multi-scale refinement
- Regression-based diffusive flux estimation
- Structured export of numerical results and figures

ğŸ“ Project Contents
-------------------

    MethaneSignalProcessor (MSP)
    â”œâ”€â”€ main.py                  # Main CLI entry point
    â”œâ”€â”€ inc/functions.py         # Core processing logic
    â”œâ”€â”€ Raw data/                # Input .txt files
    â”œâ”€â”€ Processed data/          # Output data and figures
    â”‚   â”œâ”€â”€ data/                # Processed .csv files
    â”‚   â”œâ”€â”€ results/             # Text summaries (fluxes & bubbles)
    â”‚   â””â”€â”€ plots/               # Output figures
    â”œâ”€â”€ example_outputs/         # Example outputs for reference
    â”œâ”€â”€ build_exe.bat            # Script to build Windows executable
    â”œâ”€â”€ requirements.txt         # Python dependencies
    â””â”€â”€ README.md                # Project documentation

---

## ğŸ§° Requirements

- Python â‰¥ 3.8  
- pip (Python package manager)

To build the Windows executable, **PyInstaller** is required (handled automatically by `build_exe.bat`).

---

## ğŸš€ Quick Start

### Option 1 â€” Python (Linux / macOS / Windows)
1. Clone the repository:
```bash
git clone https://github.com/ACBonet/MethaneSignalProcessor.git
cd MethaneSignalProcessor
```

2.	(Optional but recommended) Create a virtual environment:
```bash
python -m venv venv
source venv/bin/activate      # Linux / macOS
venv\Scripts\activate         # Windows
```
3.	Install dependencies:
```bash
pip install -r requirements.txt
```

4.	Run the processor:
```bash
python main.py
```

### Option 2 â€” Windows Executable (.exe)
After compilation, simply double-click:
```bash
CH4Processor.exe
```
or run it from the terminal.

The program will prompt you to:
	â€¢	Process a single .txt file, or
	â€¢	Process all .txt files located in the Raw data/ folder

Outputs are automatically written to the Processed data/ directory.

## ğŸªŸ Building the Windows Executable

To generate the executable from source:
	1.	Install Python from https://www.python.org
(ensure â€œAdd Python to PATHâ€ is checked)
	2.	Open the project folder
	3.	Double-click build_exe.bat
(or run it from the terminal)

The executable CH4Processor.exe will be created.
It expects the folders Raw data/ and Processed data/ to be located at the same level.

## ğŸ§ª Usage Summary

### Run one of the following:
```bash
python main.py        # Python usage
CH4Processor.exe      # Executable usage
```
### The tool will:
- Load .txt files from Raw data/
- Apply filtering, peak detection, and correction
- Export results to Processed data/, including:

### Numerical Outputs
- Text summaries of diffusive flux segments
- Summary statistics of diffusive fluxes
- Ebullitive event metrics (counts, rates, relative contribution)

### Graphical Outputs
Saved in Processed data/plots/:
- Original vs processed signal with detected peaks
- Step-like representation of ebullitive events
- Linear fits on diffusive segments (with slope and RÂ²)
    
## ğŸ“Š Example Outputs

Representative outputs generated by MSP can be previewed in the example_outputs/ folder.
These examples illustrate the typical graphical and numerical results obtained after processing a CHâ‚„ time-series.

**A minimal working example is provided in the `example_outputs/` folder to allow users to quickly verify correct installation and execution of the pipeline before processing their own data.**

### Graphical Outputs

The following figures are produced automatically for each processed file:

### Detected Peaks Overlay
Overlay of the original signal, corrected signal, and validated ebullitive peaks.

example_outputs/example_peaks_comparison.png

### Step-wise Ebullitive Signal
Step-like reconstruction of ebullitive contributions derived from validated peaks.

example_outputs/example_step_response.png

### Diffusive Regression Fits
Linear regression fits applied to diffusive segments, including slope and coefficient of determination (RÂ²).

example_outputs/example_slopes.png

These figures are also saved automatically for user data in Processed data/plots/.

### Reproducing the example outputs

The files provided in the `example_outputs/` folder were generated by running MSP on representative CHâ‚„ time-series acquired with floating chambers under field conditions.

To reproduce similar outputs using your own data:

1. Place one or more input `.txt` files in the `Raw data/` folder.
2. Run the processor:
```bash
python main.py
````
or, on Windows:
```bash
CH4Processor.exe
```
3. Select whether to process a single file or all files in the folder.

For each input file, MSP automatically generates:
	â€¢	Graphical outputs in Processed data/plots/
	â€¢	Numerical summaries in Processed data/results/
	â€¢	Processed time-series files in Processed data/data/

The structure, content, and interpretation of these outputs are directly comparable to the examples shown in example_outputs/.

## ğŸ“„ Example Numerical Summary

Each processed file generates a text report summarizing diffusive and ebullitive components.
An example report is provided as:
	â€¢	example_outputs/example_results.txt

This file contains a structured summary of the analysis, including:

# Source File: 30062024_1400_LAKE1

--- Diffusive Flux Segments ---
- Slope: 0.0427 ppm/s | RÂ²: 0.923 | T: 23.0Â°C | P: 610.0 mmHg | Diffusive Flux: 1016.07 Âµmol/mÂ²Â·h
- Slope: 0.1091 ppm/s | RÂ²: 0.997 | T: 24.7Â°C | P: 610.0 mmHg | Diffusive Flux: 2578.50 Âµmol/mÂ²Â·h
- Slope: 0.0155 ppm/s | RÂ²: 0.990 | T: 26.1Â°C | P: 610.0 mmHg | Diffusive Flux: 365.23 Âµmol/mÂ²Â·h
- Slope: 0.0432 ppm/s | RÂ²: 0.987 | T: 26.2Â°C | P: 610.0 mmHg | Diffusive Flux: 1016.65 Âµmol/mÂ²Â·h
- Slope: 0.0217 ppm/s | RÂ²: 0.970 | T: 26.6Â°C | P: 610.0 mmHg | Diffusive Flux: 509.01 Âµmol/mÂ²Â·h
- Slope: 0.0093 ppm/s | RÂ²: 0.939 | T: 26.6Â°C | P: 610.0 mmHg | Diffusive Flux: 218.17 Âµmol/mÂ²Â·h
- Slope: 0.0106 ppm/s | RÂ²: 0.917 | T: 26.2Â°C | P: 610.0 mmHg | Diffusive Flux: 249.16 Âµmol/mÂ²Â·h

--- Summary Statistics of Diffusive Fluxes (Âµmol/mÂ²Â·h) ---
count       7.00
mean      850.40
std       832.12
min       218.17
25%       307.20
50%       509.01
75%     1,016.36
max     2,578.50

--- Summary of Ebullitive Events ---
Peak Analysis Interval: 10
Total Adjusted CHâ‚„ Concentration (ppm): 6.48
Final CHâ‚„ Concentration (ppm): 33.49
Relative Contribution of Ebullition (%): 19.34
Number of Bubbles: 6
Index of Bubbles: [39, 125, 162, 216, 270, 305]
Total Bubble Time (h): 0.028
Bubble Rate (bubbles/h): 213.4

Equivalent numerical reports are automatically generated for user-provided data in Processed data/results/.

## âš™ï¸ Input File Format

Input .txt files must include:
- A time column (regularly sampled)
- A CHâ‚„ concentration column (ppm)
- Optional temperature and pressure columns

By default, MSP expects column names such as `time_s` (time in seconds) and `CH4_ppm` (methane concentration in ppm), as defined in `inc/functions.py`.

Example input files are provided in the Raw data/ folder.

## ğŸ§¯ Troubleshooting

### ModuleNotFoundError or missing dependencies
This error typically indicates that required Python packages are not installed.

- Ensure all dependencies are installed:
```bash
pip install -r requirements.txt
```
	â€¢	If you are using multiple Python versions, make sure pip corresponds to the same Python interpreter used to run MSP.

### â€˜pythonâ€™ command not found (Linux / macOS)
On some systems, Python is invoked as python3 instead of python.
	â€¢	Try running MSP with:
    ```bash
    python3 main.py
    ````
	â€¢	If this works, you may consistently use python3 instead of python.

If Python is not installed, download it from:
https://www.python.org/downloads/

### Executable does not find input files
When using the Windows executable (`CH4Processor.exe` or `main.py`):
	â€¢	Ensure that the folder Raw data/ is located in the same directory as the executable.
	â€¢	Verify that input files use the .txt extension and are readable.

### Input file format and expected column names
MSP assumes a specific structure for input files:
	â€¢	A time column expressed in seconds
	â€¢	A CHâ‚„ concentration column expressed in ppm

By default, column names are expected to match those defined in inc/functions.py
(e.g. time and methane concentration labels).

If your dataset uses different column names, sampling units, or additional variables,
these can be adapted directly in functions.py prior to execution.


### Configuration of physical parameters
Several physical parameters required for flux calculation are defined in functions.py,
including (but not limited to):
	â€¢	Chamber volume
	â€¢	Chamber footprint area

Users must update these parameters to match their experimental setup.
They are not requested interactively at runtime in order to:
	â€¢	Avoid repeated manual input when processing multiple files
	â€¢	Ensure consistency across batch analyses
	â€¢	Reduce the risk of user input errors during execution

This design choice prioritizes reproducibility and efficient batch processing.

### No ebullitive events detected
	â€¢	In signals with very low-amplitude fluctuations or short acquisition windows, MSP may not detect ebullitive peaks.
	â€¢	This does not indicate a processing error, but rather the absence of statistically significant bubble-driven events.
	â€¢	Users are encouraged to visually inspect the processed signal and consider the environmental context.

### Low RÂ² values in diffusive segments
	â€¢	Diffusive flux estimation assumes quasi-linear CHâ‚„ accumulation between ebullition events.
	â€¢	Rapid environmental changes (e.g. wind-induced turbulence, temperature shifts) may introduce non-linear behavior.
	â€¢	Segments with low RÂ² values are automatically excluded to ensure robustness of diffusive flux estimates.

### Unexpected or noisy results
	â€¢	Verify input data formatting and consistent time sampling.
	â€¢	Strong sensor noise or drift may affect peak detection reliability.
	â€¢	While MSP includes adaptive filtering and correction steps, extremely noisy signals should be interpreted with caution.

### Differences between sensors or deployments
	â€¢	MSP is sensor-agnostic, but absolute flux values depend on sensor calibration, chamber geometry, and deployment conditions.
	â€¢	When comparing results across sensors or sites, consistent preprocessing and calibration procedures are recommended.

## ğŸ“Œ Methodological Scope and Limitations
- MSP is designed for time-series CHâ‚„ data acquired with floating chambers.
- The pipeline assumes quasi-steady diffusive accumulation between ebullition events.
- Strong hydrodynamic forcing, rapid environmental transitions, or highly turbulent conditions may introduce non-linearities not captured by linear regression.
- MSP provides automated signal decomposition and relative flux estimates; absolute flux accuracy depends on sensor calibration, chamber geometry, and environmental conditions.
- Validation xagainst independent reference methods (e.g. GC-based measurements) should be considered when available.

## ğŸ“œ License & Citation

This project is released as open-source.

If you use MSP in your work, please cite the associated publication
(to be updated upon acceptance).
